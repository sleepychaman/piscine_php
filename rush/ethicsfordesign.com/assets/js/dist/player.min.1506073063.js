$(document).ready(function(){function t(){o=setInterval(function(){250==++r&&($("#player-controls").addClass("inactive"),e())},1)}function e(){clearInterval(o),r=0,o=null}function n(t){var e=$("#progress-bar"),n=e.width(),a=i.duration,r=100*(t-e.offset().left)/n,r=Math.max(0,r),r=Math.min(r,100);$("#current-time-bar").css("width",r+"%"),i.currentTime=a*r/100}function a(t,e){return $(e).text()<$(t).text()?1:-1}var i=$("#player-video")[0],r=0,o=null;$("#player-open button").on("click",function(){$("#overlay-instructions").addClass("out");var t=$("#player-grid-1").outerWidth(),e=$("#player-grid-1").outerHeight();$("#overlay-instructions").css({height:e,width:t}),setTimeout(function(){$("#btn-play").trigger("click"),$("#player-grid-handler").removeClass("hidden"),$("#overlay-instructions").remove(),$("#timecode").removeClass("hide"),$("#player-controls").addClass("inactive"),setTimeout(function(){i.paused&&($("#btn-play.hide").removeClass("hide"),$("#btn-pause").not(".hide").removeClass("hide"))},500)},650)}),$(document).on("touchmove",function(t){t.preventDefault()}),$("#player-controls").on("mouseenter",function(t){var n=$(this);if(n.hasClass("inactive"))return n.removeClass("inactive"),t.preventDefault(),void t.stopPropagation();r<250&&e()}),$("#player-controls").on("touchstart",function(t){var n=$(this);if(n.hasClass("inactive"))return n.removeClass("inactive"),t.preventDefault(),void t.stopPropagation();r<1e3&&e()}),$("#player-controls").on("mouseleave",function(){t()}),$("#player-controls").on("touchend",function(){t()}),$("#btn-close").on("click",function(){window.location.href=$(this).attr("data-fallback")}),$("#btn-play").on("click",function(){var t=$(this);i.play(),t.not(".hide").addClass("hide"),$("#btn-pause.hide").removeClass("hide")}),$("#btn-pause").on("click",function(){var t=$(this);i.pause(),t.addClass("hide"),$("#btn-play").removeClass("hide")});var s=!1;$("#progress-bar").on("mousedown",function(t){if($(this).closest("#player-controls").hasClass("inactive"))return!1;var e=t.pageX;s=!0,n(e)}),$(document).on("mouseup",function(t){if(s){var e=t.pageX;s=!1,n(e)}}).on("mousemove",function(t){s&&n(t.pageX)}),$("#player-btn-mute").on("click",function(){return $(this).toggleClass("muted"),i.muted=!i.muted,!1}),$("#player-volume-bar").on("mousedown touchstart",function(t){var e=$(this),n=100*(t.pageX-e.offset().left)/e.width();$("#player-current-volume").css("width",n+"%"),i.volume=n/100}),$("#player-language-picker").on("click",function(t){$(this);$(t.target).is("li")||(t.preventDefault(),t.stopPropagation()),$(this).toggleClass("active")}),$(document).on("click","#player-language-options li",function(){var t=$(this),e=(t.text(),$(this).closest(".wrap-drop")),n=e.find("#player-language-options"),i=e.find("span"),r=i.attr("data-lang"),o=i.text(),s=t,l=t.attr("data-lang"),d=t.text();i.attr("data-lang",l).text(d),s.remove(),n.append('<li data-lang="'+r+'">'+o+"</li>"),n.find("li").sort(a).appendTo(n)}),$(document).click(function(t){$("#player-language-options.active").removeClass("active")}),$(document).on("keydown",function(t){var e=t.keyCode?t.keyCode:t.which;13!=e&&32!=e||$("#btn-play, #btn-pause").not(".hide").trigger("click"),77==e&&$("#player-btn-mute").trigger("click"),37==e&&(i.currentTime=Math.max(0,i.currentTime-5)),39==e&&(i.currentTime=Math.min(i.duration,i.currentTime+5))})}),$(document).ready(function(){function t(){a=b.width(),i=b.height(),_videoH=C.outerHeight(),r=C.outerWidth(),o=100*(_videoH-1)/i,l=100-(s=100*r/a),d=60,u=40,c=o}function e(){var t=m.width()/12,t=Math.min(40,t),e=(t=b.width()<1024?Math.max(24,t):Math.max(30,t))*(38/30);m.find("p").css({"font-size":t,"line-height":e+"px"})}function n(){var t=$("#player-video"),e=$.Event("mousemove");e.pageX=t.offset().left,e.pageY=t.height();f.on("mousemove",T),f.trigger(e),f.unbind("mousemove",T)}var a,i,r,o,s,l,d,u,c,f=$("#player-grid"),h=$("#player-grid-handler"),m=$("#player-grid-1"),p=$("#player-grid-2"),g=$("#player-grid-3"),v=$("#player-grid-4"),y=$("#player-grid-5"),b=$(window),w=!1,C=$("#player-video"),x={x:0,y:0};C.on("loadeddata",function(){t(),n(),e()}),b.on("resize",function(){t(),n()});var k=function(t){x.x=t.pageX,x.y=t.pageY},T=function(t){w&&requestAnimationFrame(T);var n=100*(r=x.x)/a,n=Math.max(l,n),r=n=Math.min(d,n),o=100*(s=x.y)/i,o=Math.max(u,o),s=o=Math.min(c,o);h.css({left:r+"%",top:s+"%"}),m.css({width:r+"%",height:s+"%"}),p.css({left:r+"%",width:100-r+"%",height:s+"%"}),g.css({width:r+"%",height:100-s+"%",top:s+"%"}),v.css({width:(100-r)/2+"%",height:100-s+"%",left:r+"%",top:s+"%"}),y.css({width:(100-r)/2+"%",height:100-s+"%",left:r+(100-r)/2+"%",top:s+"%"}),e()};h.on({mouseenter:function(){h.addClass("hovered")},mouseleave:function(){w||h.removeClass("hovered")},mousedown:function(){w=!0,h.not(".hovered").addClass("hovered"),requestAnimationFrame(T)},touchstart:function(t){t.preventDefault(),w=!0,h.not(".hovered").addClass("hovered"),requestAnimationFrame(T)}}),$(document).on({mouseup:function(){h.removeClass("hovered"),w=!1},mousemove:function(t){k(t)},touchmove:function(t){k(t.originalEvent)},touchend:function(){h.removeClass("hovered"),w=!1}}),n()}),$(document).ready(function(){function t(){j=$(".player-grid-video"),U=$(".player-grid-subtitles"),Y=$(".player-grid-images-left"),L=$(".player-grid-images-right"),N=$(".player-grid-side-text")}function e(t){G.load(),$(document).unbind("touchstart",e)}function n(t,e){$("#progress-bar").width();var n=100*t/e,a=-1==(a=b(t)).indexOf("mn")?"00mn"+a:a;$("#current-time-bar").css("width",n+"%"),$("#current-timer-number").text(a)}function a(t,e){var n=0,a=G.buffered;if(a.length&&4==G.readyState){for(;!(a.start(n)<=t&&t<=a.end(n));)n+=1;var i=a.end(n)/e*100,i=Math.floor(i);$("#buffer-bar").css("width",i+"%")}}function i(t){S=null,X=null,O=null,P=null,q=null,M&&(M.forEach(function(e,n,a){t>=e.start&&t<=e.end&&(S=n)}),r(S)),E&&(E.forEach(function(e,n,a){t>=e.start&&t<=e.end&&(X=n)}),o(X)),I&&(I.forEach(function(e,n,a){t>=e.start&&t<=e.end&&(O=n)}),l(O)),H&&(H.forEach(function(e,n,a){t>=e.start&&t<=e.end&&(P=n)}),d(P)),_&&(_.forEach(function(e,n,a){t>=e.start&&t<=e.end&&(q=n)}),u(q))}function r(t){var e=U.find("p");if(null==t)return e.length&&""!=e.html().trim()&&e.empty(),void(F=null);if(t!=F){var n=M[t].text;(e=U.find("p")).length||U.empty().append("<p></p>"),e.html(n),F=t}}function o(t){if(null!=t){if(t!=R){var e=E[t],n=C+"/images/"+e.text,a=new Image;a.src=n,a.onload=function(){var t=Y.find(".image");t.length?t.css("background-image",'url("'+n+'")').removeClass("fading"):(Y.empty().html('<div class="image fading" style="background-image: url('+n+')"></div>'),setTimeout(function(){Y.find(".image").removeClass("fading")},50))},R=t}}else if(Y.find(".image:not(.fading)").length){var i=Y.find(".image");i.addClass("fading"),setTimeout(function(){i.remove(),R=null},1e3)}}function l(t){if(null!=t){if(t!=W){var e=I[t],n=C+"/images/"+e.text,a=new Image;a.src=n,a.onload=function(){var t=L.find(".image");t.length?t.css("background-image",'url("'+n+'")').removeClass("fading"):(L.empty().html('<div class="image fading" style="background-image: url('+n+')"></div>'),setTimeout(function(){L.find(".image").removeClass("fading")},50))},W=t}}else L.find(".image:not(.fading)").length&&(L.find(".image").addClass("fading"),setTimeout(function(){L.empty(),W=null},1e3))}function d(t){if(null==t)return""!=N.html().trim()&&N.empty(),void(z=null);if(t!=z){var e=(n=H[t].text).indexOf(" + ")?"array":"string",n=n.indexOf(" + ")?n.split(" + "):n,a="";if("string"==e){var i=n.split("::")[0],r=n.split(":: ")[1];a+='<p class="'+i+'">'+r+"</p>"}else"array"==e&&n.forEach(function(t,e,n){var i=t.split("::")[0],r=t.split(":: ")[1];a+='<p class="'+i+'">'+r+"</p>"});N.html(a),z=t}}function u(e){function n(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value}if(null==e)return!1;if(e==A)return!1;var a=_[e];a=(a=a.text).split(" + "),_contents=[],_contents["side-text"]=N.html(),_contents["images-left"]=Y.html(),_contents["images-right"]=L.html(),a.forEach(function(t,e,a){var e=e+1,i=$("#player-grid-"+e);i.attr("data-content")!=t&&i.attr("class","player-grid-entry player-grid-"+t).attr("data-content",t).html(n(_contents[t]))}),t(),A=e}function c(t){var e=v(J,t);$.get(e,function(t){M=y(t)})}function f(){$.get(x,function(t){E=y(t)})}function h(){$.get(k,function(t){I=y(t)})}function m(t){var e=v(K,t);$.get(e,function(t){H=y(t)})}function p(t){function e(){D.forEach(function(t,e,n){var a=$("#progress-bar"),i=t.start,r=t.text,o=a.find('.chapter[data-time="'+i+'"]'),s=100*i/G.duration;if(o.length)o.attr("data-content",r);else{var l='<div class="chapter" style="left: '+s+'%" data-content="'+r+'" data-time="'+i+'"></div>';$("#progress-bar").append(l)}})}var n=v(Q,t);$.get(n,function(t){D=y(t),e()})}function g(){$.get(T,function(t){_=y(t)})}function v(t,e){for(var n=0;n<t.length;n++)if(t[n][0]==e)return t[n][1]}function y(t){var e,n,a,i,r,o=[];return t?(t=t.trim(),t+="\n",(t=t.replace(/\r\n/g,"\n").replace(/\n{3,}/g,"\n\n").split("\n")).forEach(function(t){if(t=t.toString(),t=t.replace(/\*(.*?)\*/g,"<i>$1</i>"),e||!/^\d+$/.test(t)){if(!n){var s=t.match(/^(\d{2}:\d{2}:\d{2},\d{2,}) --> (\d{2}:\d{2}:\d{2},\d{2,})$/);if(s)return i=s[1],r=s[2],void(n=!0)}if(""===t.trim()){var l=w(r),d=w(i);o.push({index:e,start:d,end:l,text:a||""}),e=n=i=r=a=null}else a?a+="\n"+t:a=t}else e=parseInt(t)}),o):"No SRT to parse"}function b(t){var e=parseInt(t,10),n=Math.floor(e/3600),a=Math.floor((e-3600*n)/60),i=e-3600*n-60*a;return n<10&&(n="0"+n),a<10&&(a="0"+a),i<10&&(i="0"+i),"00"==n?a+" mn "+i+" s":n+" h"+a+" mn "+i+" s"}function w(t){var e=t.match(/^(\d{2}):(\d{2}):(\d{2}),(\d{2,})$/);if(!e)throw new Error("Invalid SRT time format");var n=parseInt(e[1],10),a=parseInt(e[2],10),i=parseInt(e[3],10),r=parseInt(e[4],10);return n*=36e5,a*=6e4,i*=1e3,ms=n+a+i+r,s=ms/1e3,s}var C,x,k,T,M,E,I,H,_,D,S,X,O,P,q,A,F,R,W,z,U,Y,L,N,j,B=$("#player-video"),G=B[0],J=[],K=[],Q=[],V=function(t){var e=new RegExp("[&|?]"+t+"=([^&#]+)"),n=window.location.search.match(e);return n||History.replaceState(null,document.title,window.location.href+"?lang=en"),n?n[1]:"en"}("lang");t(),function(){var t=$("#player-urls"),e=t.find("#subtitles .subtitle"),n=t.find("#side-texts .side-text"),a=t.find("#chapters .chapter"),i=t.find("#images-left"),r=t.find("#images-right"),o=t.find("#layout-changes");C=t.attr("data-url"),e.each(function(){var t=$(this),e=t.attr("data-code"),n=t.attr("data-url");J.push([e,n])}),n.each(function(){var t=$(this),e=t.attr("data-code"),n=t.attr("data-url");K.push([e,n])}),a.each(function(){var t=$(this),e=t.attr("data-code"),n=t.attr("data-url");Q.push([e,n])}),x=i.attr("data-url"),k=r.attr("data-url"),T=o.attr("data-url"),t.remove()}(),$(document).on("touchstart",e),$(document).trigger("touchstart"),B.on("loadedmetadata",function(){var t=b(t=G.duration);$("#final-timer-number").text(t),$(".volume").css("width",100*G.volume+"%"),p(V)}),B.on("loadeddata",function(){setTimeout(function(){$("#player-open .player-loading-button").addClass("hide"),$("#player-open .player-open-button").removeClass("hide")},250)}),B.on("timeupdate",function(){var t=G.currentTime,e=G.duration;t==e&&($("#btn-play").removeClass("hide"),$("#btn-pause").addClass("hide"),t=0),n(t,e),a(t,e),i(t)}),$(document).on({mouseenter:function(){var t=$(this),e=$("#tooltip-chapter"),n=t.attr("data-content"),a=t.offset().left+t.width()/2;e.html(n);var i=a-e.outerWidth()/2;e.css("left",i).removeClass("visually-hidden")},mouseleave:function(){$("#tooltip-chapter").not(".visually-hidden").addClass("visually-hidden")},mousedown:function(t){return t.preventDefault(),t.stopPropagation(),!1},click:function(){var t=$(this),e=t.offset().left+t.width()/2,n=$("#progress-bar").width(),a=G.duration,i=100*e/n,i=Math.max(0,i),i=Math.min(i,100);$("#current-time-bar").css("width",i+"%"),G.currentTime=a*i/100}},".chapter"),function(t){c(t),f(),h(),m(t),g();var e=$("#drop-language li.selected");!e.attr("data-lang")!=t&&(e.removeClass("selected"),$('#drop-language li[data-lang="'+t+'"]').addClass("selected"),$("#drop-language > span").first().text(t.toUpperCase()))}(V),function(t){var e=$("#player-language-picker"),n=e.find("li[data-lang="+t+"]");e.find("span.selected").text(t.toUpperCase()).attr("data-lang",t),n.remove()}(V),$(document).on("click","#player-language-picker li",function(){var t=$(this).attr("data-lang");c(t),m(t),p(t);var e=window.location.href,n=e.substr(0,e.lastIndexOf("="))+"="+t,a=document.title;History.replaceState(null,a,n)})});